<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>PIX API - Banco BV</title>

<link rel="stylesheet" href="https://unpkg.com/swagger-ui-dist/swagger-ui.css" />
<link rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css" />

<style>
  :root{
    --sidebar-width: 240px;
    --right-width: 480px;
    --brand: #1b6bb3; /* adjusted brand */
    --muted: #6b7280;
    --bg: #f7f7f7;
    --right-bg: #263238;
    --right-card: #0e1416;
    --accent: #2dd4bf;
  }

  html, body {
    margin: 0;
    height: 100%;
    font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial, Helvetica;
    background: var(--bg);
    color: #0b1220;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
  }

  /* ===== LAYOUT ===== */
  .layout {
    display: grid;
    grid-template-columns: var(--sidebar-width) 1fr var(--right-width);
    height: 100vh;
  }

  /* ===== SIDEBAR ===== */
  .sidebar {
    background: #fff;
    border-right: 1px solid #e6e9ee;
    padding: 20px 14px;
    overflow-y: auto;
    display:flex;
    flex-direction:column;
    gap:14px;
  }

  .brand {
    display:flex;
    align-items:center;
    padding-bottom: 6px;
    border-bottom: 1px solid #f0f0f0;
  }

  .brand-logo {
    height: 56px;
    width: auto;
    display:block;
  }

  .sidebar .search {
    display:flex;
    align-items:center;
    padding-top: 8px;
  }

  .sidebar .search input[type="search"] {
    width: 100%;
    padding: 8px 10px;
    border-radius: 6px;
    border: 1px solid #e6e9ee;
    background: #fbfdff;
    font-size: 13px;
  }

  .nav {
    margin: 0;
    padding: 8px 4px;
    list-style:none;
    overflow:auto;
  }

  .tag-item {
    display:block;
    margin-bottom:6px;
    border-radius:6px;
    cursor:pointer;
    font-size:13px;
    color:#0b1220;
    transition: background .12s, transform .06s;
    padding: 6px;
  }

  .tag-item:hover { background: rgba(0,0,0,0.03); transform: translateY(-1px); }
  .tag-item.active { background: linear-gradient(90deg,#eef6ff,#ffffff); border:1px solid rgba(0,47,108,0.04); }

  .tag-head {
    display:flex;
    align-items:center;
    justify-content:space-between;
    gap:10px;
  }

  .tag-head strong { font-weight:600; color: #0b1220; font-size:13px; }

  .tag-count {
    background: rgba(0,47,108,0.06);
    color: var(--brand);
    padding: 4px 8px;
    border-radius:999px;
    font-size:12px;
  }

  .ops {
    margin-top:8px;
    padding-left:6px;
    display:flex;
    flex-direction:column;
    gap:6px;
  }

  .op-link {
    display:flex;
    gap:10px;
    align-items:center;
    padding:6px 8px;
    border-radius:6px;
    font-size:13px;
    color:#374151;
    background: transparent;
    border: none;
    text-align:left;
    cursor:pointer;
  }

  .op-link:hover { background: rgba(0,0,0,0.03); }

  .op-link.active {
    background: rgba(0,0,0,0.04);
    box-shadow: inset 3px 0 0 var(--brand);
    color: #0b1220;
    font-weight:600;
  }

  .method-pill-left {
    padding:4px 8px;
    border-radius:6px;
    font-weight:700;
    font-size:11px;
    color:#fff;
    min-width:46px;
    text-align:center;
  }
  .method-get { background:#16a34a; }
  .method-post { background:#0ea5e9; }
  .method-put { background:#f59e0b; color:#0b1220; }
  .method-delete { background:#ef4444; }

  .op-path {
    font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, monospace;
    font-size:12px;
    color:#6b7280;
  }

  /* ===== CONTENT ===== */
  .content {
    background: #fff;
    overflow-y: auto;
  }

  .swagger-ui {
    padding: 28px 42px;
    max-width: 900px;
    margin: 0 auto;
  }

  /* Make the default swagger opblocks spacing similar to screenshot */
  .swagger-ui .opblock {
    border: none;
    box-shadow: none;
  }

  /* ===== RIGHT PANEL ===== */
  .code-panel {
    background: var(--right-bg);
    border-left: 1px solid rgba(255,255,255,0.03);
    padding: 18px;
    color: #fff;
    overflow-y: auto;
    display:flex;
    flex-direction:column;
    gap:18px;
  }

  .endpoint-header {
    display:flex;
    justify-content:space-between;
    align-items:center;
    gap:12px;
  }

  .endpoint-title {
    display:flex;
    align-items:center;
    gap:8px;
  }

  .method-pill {
    padding:6px 10px;
    border-radius:6px;
    font-weight:700;
    font-size:12px;
    color:#fff;
  }
  .method-pill.get { background:#16a34a; }
  .method-pill.post { background:#0ea5e9; }
  .method-pill.put { background:#f59e0b; color:#0b1220; }
  .method-pill.delete { background:#ef4444; }

  .path-text { color: rgba(255,255,255,0.95); font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, monospace; font-size:13px; }

  .controls { display:flex; gap:8px; align-items:center; }

  .btn {
    background: rgba(255,255,255,0.06);
    border: 1px solid rgba(255,255,255,0.04);
    color: #fff;
    padding:6px 8px;
    border-radius:8px;
    cursor:pointer;
    font-size:13px;
  }
  .btn.primary { background: linear-gradient(90deg,#0ea5e9,#2dd4bf); color:#06202a; font-weight:700; border:none; }

  .responses-wrapper {
    background: var(--right-card);
    border-radius:6px;
    padding:16px;
    color:#cfe8df;
  }

  .responses-wrapper pre {
    background: transparent !important;
    border-radius: 6px;
    padding:0;
    overflow:auto;
    color: #9be1cc;
  }

  .response-badges {
    display:flex;
    gap:8px;
    margin-bottom:10px;
  }

  .response-badges .badge {
    padding:6px 8px;
    border-radius:6px;
    background: rgba(255,255,255,0.03);
    color:#cfe8df;
    font-weight:700;
    font-size:12px;
  }

  .panel-empty { color: rgba(255,255,255,0.6); font-size:13px; padding:8px; }

  /* Responsive: collapse right panel on narrow screens */
  @media (max-width: 1200px) {
    .layout { grid-template-columns: 260px 1fr; }
    .code-panel { display: none; }
  }

  @media (max-width: 880px) {
    .layout { grid-template-columns: 1fr; }
    .sidebar { position: fixed; left:0; top:0; bottom:0; width:76%; max-width:380px; transform: translateX(-120%); transition:transform .22s; z-index:90; box-shadow:8px 0 32px rgba(2,6,23,0.12); }
    .sidebar.open { transform: translateX(0); }
  }

  /* small helpers */
  .muted { color: var(--muted); font-size:12px; }
</style>
</head>

<body>
<div class="layout">

  <!-- SIDEBAR -->
  <aside class="sidebar" id="sidebar" role="navigation" aria-label="Sidebar">
    <div class="search" aria-hidden="false">
      <input id="sidebar-search" type="search" placeholder="Search..." aria-label="Buscar" />
    </div>

    <nav>
      <ul id="sidebar-menu" class="nav" aria-live="polite" aria-label="Lista de tags"></ul>
    </nav>
  </aside>

  <!-- CONTENT -->
  <main class="content" id="content">
    <div id="swagger-ui" class="swagger-ui"></div>
  </main>

  <!-- RIGHT PANEL -->
  <aside class="code-panel" id="code-panel" aria-live="polite" aria-atomic="true">
    <div class="endpoint-header">
      <div class="endpoint-title">
        <span id="code-method" class="method-pill default">OP</span>
        <div id="code-path" class="path-text">/caminho/exemplo</div>
      </div>
      <div class="controls">
        <button id="code-copy" class="btn">Copiar</button>
        <button id="code-open" class="btn">Ir ao endpoint</button>
      </div>
    </div>

    <div id="code-view"><div class="panel-empty">Abra uma operação (clicando em um endpoint) para ver exemplos de respostas e códigos aqui.</div></div>
  </aside>

</div>

<!-- scripts -->
<script src="https://unpkg.com/swagger-ui-dist/swagger-ui-bundle.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>

<script>
/*
  Enhanced sidebar that mirrors the layout in the provided screenshot:
  - Lists tags with counts.
  - Under each tag, lists operations with method pill + path.
  - Clicking an operation scrolls to and opens the opblock (by dispatching a click on Swagger's .opblock-summary).
  - Search filters tags & operations.
  - Right panel remains the cloned response area.
*/

const SWAGGER_URL = "https://camargofe.github.io/LwcDocumentacaoAPI/pix.yaml";
let lastClickedOpblock = null;

// Initialize Swagger UI
SwaggerUIBundle({
  url: SWAGGER_URL,
  dom_id: "#swagger-ui",
  layout: "BaseLayout",
  deepLinking: true,
  presets: [SwaggerUIBundle.presets.apis]
});

// small helpers
const $qs = (s, scope = document) => scope.querySelector(s);
const $qsa = (s, scope = document) => Array.from((scope || document).querySelectorAll(s));

function waitForSwaggerReady(timeout = 12000) {
  return new Promise((resolve, reject) => {
    const start = Date.now();
    (function check() {
      if ($qsa('.opblock-tag').length > 0) return resolve();
      if (Date.now() - start > timeout) return reject(new Error('Swagger UI did not render in time'));
      requestAnimationFrame(check);
    })();
  });
}

/* Build sidebar with tags and nested operations */
function buildSidebar() {
  const menu = document.getElementById('sidebar-menu');
  menu.innerHTML = '';

  const tags = $qsa('.opblock-tag');
  tags.forEach(tagEl => {
    const titleSpan = tagEl.querySelector('h3 span');
    if (!titleSpan) return;
    const titleText = titleSpan.textContent.trim();

    const operations = tagEl.querySelectorAll('.opblock-summary');
    const count = operations.length;

    const li = document.createElement('li');
    li.className = 'tag-item';
    li.tabIndex = 0;

    const head = document.createElement('div');
    head.className = 'tag-head';
    head.innerHTML = `<strong>${escapeHtml(titleText)}</strong><div class="tag-count">${count}</div>`;
    li.appendChild(head);

    // operations list
    const opsContainer = document.createElement('div');
    opsContainer.className = 'ops';

    operations.forEach(op => {
      const method = op.querySelector('.opblock-summary-method')?.textContent?.trim() || '';
      const path = op.querySelector('.opblock-summary-path')?.textContent?.trim() || '';
      const btn = document.createElement('button');
      btn.className = 'op-link';
      btn.type = 'button';
      btn.innerHTML = `<div class="method-pill-left method-${method.toLowerCase()}">${escapeHtml(method)}</div>
                       <div style="display:flex;flex-direction:column;align-items:flex-start;">
                         <div style="font-size:13px;color:#0b1220;">${escapeHtml(path)}</div>
                         <div class="op-path" style="margin-top:2px">${escapeHtml(path)}</div>
                       </div>`;

      // wire click: simulate click on corresponding swagger opblock-summary element to open it
      btn.addEventListener('click', () => {
        const opblock = op.closest('.opblock');
        if (!opblock) return;

        // prefer to invoke Swagger's summary click to ensure correct behavior
        const summary = opblock.querySelector('.opblock-summary');
        if (summary) {
          summary.scrollIntoView({ behavior: 'smooth', block: 'center' });
          summary.click();
          lastClickedOpblock = opblock;
          // update right panel after a small delay to allow Swagger to render examples
          setTimeout(() => updateRightPanel(opblock), 220);
        }
      });

      opsContainer.appendChild(btn);
    });

    li.appendChild(opsContainer);

    // expand/collapse by clicking tag head
    head.addEventListener('click', () => {
      const isActive = li.classList.contains('active');
      // collapse all
      Array.from(menu.children).forEach(n => n.classList.remove('active'));
      if (!isActive) li.classList.add('active');
      // scroll tag into view
      tagEl.scrollIntoView({ behavior: 'smooth', block: 'center' });
    });

    menu.appendChild(li);
  });
}

/* Set active tag visually (keeps minimal behavior like screenshot) */
function setActiveTag(name) {
  const menu = document.getElementById('sidebar-menu');
  Array.from(menu.children).forEach(li => {
    const tagName = li.querySelector('.tag-head strong')?.textContent?.trim();
    li.classList.toggle('active', tagName === name);
  });
}

/* Filter sidebar items by search */
function wireSearch() {
  const input = document.getElementById('sidebar-search');
  if (!input) return;
  input.addEventListener('input', () => {
    const q = input.value.trim().toLowerCase();
    const items = $qsa('#sidebar-menu .tag-item');
    items.forEach(item => {
      const tagName = item.querySelector('.tag-head strong')?.textContent?.toLowerCase() || '';
      const ops = Array.from(item.querySelectorAll('.op-link'));
      let anyOpMatch = false;
      ops.forEach(op => {
        const txt = op.textContent.toLowerCase();
        const match = q === '' || txt.includes(q);
        op.style.display = match ? '' : 'none';
        if (match) anyOpMatch = true;
      });
      // show tag if tag matches or any op matches
      const tagMatch = q === '' || tagName.includes(q);
      item.style.display = (tagMatch || anyOpMatch) ? '' : 'none';
    });
  });
}

/* Bind clicks on opblock summaries (delegation) to capture last clicked opblock
   We DO NOT prevent default: let Swagger open the block so examples render. */
function bindEndpointClicks() {
  const container = document.getElementById('swagger-ui');
  if (!container) return;

  container.addEventListener('click', (e) => {
    const summary = e.target.closest('.opblock-summary');
    if (!summary) return;
    const opblock = summary.closest('.opblock');
    if (!opblock) return;

    lastClickedOpblock = opblock;
    setTimeout(() => updateRightPanel(opblock), 220);
  });

  // keyboard activation
  container.addEventListener('keydown', (e) => {
    if (e.key !== 'Enter' && e.key !== ' ') return;
    const summary = e.target.closest('.opblock-summary');
    if (!summary) return;
    const opblock = summary.closest('.opblock');
    if (!opblock) return;

    lastClickedOpblock = opblock;
    setTimeout(() => updateRightPanel(opblock), 220);
  });
}

/* Observe class changes so we catch programmatic opens or other ways the opblock is opened */
function observeOpblockOpenEvents() {
  const uiRoot = document.querySelector('.swagger-ui');
  if (!uiRoot) return;

  const mo = new MutationObserver(mutations => {
    for (const m of mutations) {
      if (m.type === 'attributes' && m.attributeName === 'class') {
        const target = m.target;
        if (target.classList && target.classList.contains('opblock') && target.classList.contains('is-open')) {
          const preferred = lastClickedOpblock || target;
          setTimeout(() => updateRightPanel(preferred), 80);
          // also update sidebar active op visually
          highlightSidebarOp(preferred);
        }
      }

      if (m.addedNodes && m.addedNodes.length) {
        // new opblocks rendered -> rebuild sidebar (debounced)
        clearTimeout(window._rebuild_sidebar);
        window._rebuild_sidebar = setTimeout(() => {
          buildSidebar();
          wireSearch();
        }, 160);
      }
    }
  });

  mo.observe(uiRoot, { subtree: true, childList: true, attributes: true, attributeFilter: ['class'] });
}

/* Highlight corresponding op in the sidebar */
function highlightSidebarOp(opblock) {
  if (!opblock) return;
  const method = opblock.querySelector('.opblock-summary-method')?.textContent?.trim() || '';
  const path = opblock.querySelector('.opblock-summary-path')?.textContent?.trim() || '';

  // find matching op-link
  const ops = $qsa('#sidebar-menu .op-link');
  ops.forEach(op => {
    const text = op.textContent || '';
    const isMatch = text.includes(path) && text.includes(method);
    op.classList.toggle('active', isMatch);
    // ensure parent tag is active/expanded
    if (isMatch) {
      const tagItem = op.closest('.tag-item');
      if (tagItem) {
        Array.from(document.querySelectorAll('#sidebar-menu .tag-item')).forEach(t => t.classList.remove('active'));
        tagItem.classList.add('active');
      }
    }
  });
}

/* Find the responses/examples area inside an opblock reliably */
function findResponsesWrapper(opblockEl) {
  if (!opblockEl) return null;

  // Common directly available wrapper
  let node = opblockEl.querySelector('.responses-wrapper');
  if (node) return node;

  // Some swagger versions place responses inside sections
  node = opblockEl.querySelector('.opblock-body .responses-wrapper');
  if (node) return node;

  node = opblockEl.querySelector('.opblock-section .responses-wrapper');
  if (node) return node;

  // Examples can be under .response or inside tables; try to find <pre> blocks
  const pre = opblockEl.querySelector('pre');
  if (pre) {
    const wrapper = document.createElement('div');
    wrapper.className = 'responses-wrapper';
    wrapper.appendChild(pre.cloneNode(true));
    return wrapper;
  }

  // No responses found
  return null;
}

/* Update right panel with cloned responses from the given opblock (or fallback logic) */
function updateRightPanel(preferredOpblock) {
  const panel = document.getElementById('code-view');
  panel.innerHTML = '';

  // Determine target opblock: prefer provided, then lastClickedOpblock, then first open
  let opblock = preferredOpblock || lastClickedOpblock || document.querySelector('.opblock.is-open');
  if (!opblock) {
    // nothing to show
    panel.innerHTML = '<div class="panel-empty">Abra uma operação (clicando em um endpoint) para ver exemplos de respostas e códigos aqui.</div>';
    return;
  }

  // If the opblock is not open yet (no .is-open) we still try, but prefer that the user click so Swagger renders content.
  const method = opblock.querySelector('.opblock-summary-method')?.textContent?.trim() || '';
  const path = opblock.querySelector('.opblock-summary-path')?.textContent?.trim() || '';

  // Header
  const codeMethodEl = document.getElementById('code-method');
  codeMethodEl.className = 'method-pill ' + (method ? method.toLowerCase() : 'default');
  codeMethodEl.textContent = method || 'OP';
  document.getElementById('code-path').textContent = path || '';

  // Try to find responses
  let responses = findResponsesWrapper(opblock);

  // If not found, but the opblock is not open, give Swagger a small moment (sometimes rendering is slightly delayed)
  if (!responses && !opblock.classList.contains('is-open')) {
    setTimeout(() => updateRightPanel(opblock), 240);
    panel.innerHTML = '<div class="panel-empty">Carregando exemplos...</div>';
    return;
  }

  if (!responses) {
    panel.innerHTML = '<div class="panel-empty">Nenhuma resposta de exemplo encontrada para este endpoint.</div>';
    return;
  }

  // Clone responses for the right panel
  const clone = responses.cloneNode(true);
  clone.classList.add('responses-wrapper');

  // Remove interactive elements not useful in the right panel
  clone.querySelectorAll('.try-out, .execute, .btn, .model, .responses-request, .parameters, .tab, .tabbed').forEach(n => n.remove());

  // Normalize any pre/code blocks for highlight.js
  clone.querySelectorAll('pre, code').forEach(el => {
    el.style.whiteSpace = 'pre';
    el.style.wordBreak = 'break-word';
    el.classList.add('hljs');
  });

  // Add simple response badges like screenshot
  const badges = document.createElement('div');
  badges.className = 'response-badges';
  badges.innerHTML = `<div class="badge">200</div><div class="badge">403</div><div class="badge">503</div>`;
  panel.appendChild(badges);

  panel.appendChild(clone);

  // Highlight code blocks inside panel
  panel.querySelectorAll('pre code').forEach(block => {
    try { hljs.highlightElement(block); } catch(e) { /* ignore */ }
  });

  // Setup copy button to copy concatenated code blocks or panel text
  const copyBtn = document.getElementById('code-copy');
  copyBtn.onclick = async () => {
    let text = '';
    const codes = panel.querySelectorAll('pre code');
    if (codes.length) {
      text = Array.from(codes).map(c => c.innerText).join('\n\n---\n\n');
    } else {
      text = panel.innerText;
    }
    try {
      await navigator.clipboard.writeText(text);
      copyBtn.textContent = 'Copiado ✓';
      setTimeout(() => copyBtn.textContent = 'Copiar', 1200);
    } catch {
      copyBtn.textContent = 'Erro';
      setTimeout(() => copyBtn.textContent = 'Copiar', 1200);
    }
  };

  // When "Ir ao endpoint" is clicked, scroll to the opblock and briefly highlight it
  const openBtn = document.getElementById('code-open');
  openBtn.onclick = () => {
    opblock.scrollIntoView({ behavior: 'smooth', block: 'center' });
    const prev = opblock.style.boxShadow;
    opblock.style.boxShadow = '0 10px 36px rgba(14,165,233,0.12)';
    setTimeout(() => opblock.style.boxShadow = prev || '', 900);
  };
}

/* Utility: escape text for safe insertion */
function escapeHtml(str) {
  return String(str).replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
}

/* Initialize everything after Swagger UI renders */
(async function init() {
  try {
    await waitForSwaggerReady();

    // Build sidebar and wire interactions
    buildSidebar();
    wireSearch();
    bindEndpointClicks();
    observeOpblockOpenEvents();

    // If an opblock is already open on load, populate right panel for it
    setTimeout(() => {
      const open = document.querySelector('.opblock.is-open');
      if (open) {
        lastClickedOpblock = open;
        updateRightPanel(open);
        highlightSidebarOp(open);
      }
    }, 300);
  } catch (err) {
    console.warn('Erro inicializando UI melhorada:', err);
  }
})();
</script>
</body>
</html>
